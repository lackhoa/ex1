name: Test workflow

on:
  push:
    branches:
      - '**'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repo
      if: false
      uses: actions/checkout@v2
      with:
        token: ${{ secrets.PAT }}

    - name: test
      id: test
      run: echo hello this is a test

    - uses: LouisBrunner/checks-action@v1.1.1
      if: always()
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        name: xyz
        conclusion: ${{ job.status }}
        output: |
          {"summary":"${{ steps.test.outcome }}"}

  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repo
      if: false
      uses: actions/checkout@v2
      with:
        token: ${{ secrets.PAT }}

    - name: Wait on tests
      uses: lewagon/wait-on-check-action@v0.2
      with:
        ref: ${{ github.ref }}
        check-name: xyz
        repo-token: ${{ secrets.GITHUB_TOKEN }}

    - name: Now this job can run
      run: echo Waiting is complete
